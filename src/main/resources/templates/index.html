<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calendar • To-Do</title>

  <!-- Bootstrap WebJar -->
  <link rel="stylesheet" th:href="@{/webjars/bootstrap/5.3.3/css/bootstrap.min.css}">
  <!-- SweetAlert2 WebJar -->
  <link rel="stylesheet" th:href="@{/webjars/sweetalert2/11.14.1/dist/sweetalert2.min.css}">
  <!-- App styles (라이트/다크 통합본) -->
  <link rel="stylesheet" th:href="@{/css/style.css}" />
  <!-- Chatbot popup styles -->
  <link rel="stylesheet" th:href="@{/css/chatbot-popup.css}" />

  <!-- FOUC 방지: 저장된 테마를 초기에 바로 적용 -->
  <script>
    (function () {
      try {
        const saved = localStorage.getItem('theme');
        if (saved === 'dark') document.documentElement.classList.add('dark');
      } catch (e) { /* localStorage 미사용 환경 대비 */ }
    })();
  </script>
</head>
<body>
  <div class="app container-lg">
    <!-- Header -->
    <header class="app-header">
      <div class="brand">
        <span class="dot" aria-hidden="true"></span>
        <span>Calendar • To-Do</span>
      </div>

      <!-- 버튼 그룹: 오늘로 이동 + 테마 전환 -->
      <div class="d-flex gap-2">
        <button class="today-btn btn btn-light border" id="todayBtn" type="button">오늘로 이동</button>
        <button class="today-btn btn btn-light border" id="themeToggle" type="button" aria-label="테마 전환">다크 모드</button>
      </div>
    </header>

    <!-- Main Grid -->
    <section class="row g-4">
      <!-- Calendar Card -->
      <article class="card col-12 col-xl-8 col-lg-7 p-0">
        <div class="card-header">
          <div class="cal-top">
            <div class="cal-title" id="calTitle"></div>
            <div class="subtle" id="monthMeta"></div>
          </div>
          <div class="cal-nav">
            <button class="icon-btn btn btn-outline-secondary" id="prevBtn" title="이전 달" aria-label="이전 달" type="button">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none"
                   stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="15 18 9 12 15 6"/>
              </svg>
            </button>
            <button class="icon-btn btn btn-outline-secondary" id="nextBtn" title="다음 달" aria-label="다음 달" type="button">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none"
                   stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="9 18 15 12 9 6"/>
              </svg>
            </button>
          </div>
        </div>

        <div class="weekday px-2 pt-2" aria-hidden="true">
          <div>일</div><div>월</div><div>화</div><div>수</div><div>목</div><div>금</div><div>토</div>
        </div>
        <div class="month-grid" id="monthGrid" role="grid" aria-label="월간 달력"></div>
      </article>

      <!-- To-Do Card -->
      <article class="card col-12 col-xl-4 col-lg-5 p-0">
        <div class="card-header">
          <div class="todo-top">
            <strong id="selectedDateLabel"></strong>
            <span class="date-chip" id="todoStats">0개 할 일</span>
          </div>
          <div class="add-wrap mt-2">
            <input id="todoInput" class="input form-control" type="text" placeholder="할 일을 입력하고 Enter" />
            <button id="addBtn" class="primary-btn btn" type="button">추가</button>
          </div>
        </div>
        <div class="card-body">
          <div class="todo-list" id="todoList" aria-live="polite"></div>
          <div class="empty mt-2" id="emptyState" hidden>오늘의 할 일이 없어요</div>
          <div class="subtle footer-hint">
            <span>수정 버튼 • 저장 • 삭제</span>
            <span class="d-flex gap-2">
              <button class="ghost-btn btn btn-outline-secondary" id="clearDoneBtn" type="button">선택 삭제</button>
              <button class="ghost-btn btn btn-outline-secondary" id="clearAllBtn" type="button">전체 삭제</button>
            </span>
          </div>
        </div>
      </article>
    </section>

    <!-- Footer -->
    <p class="footer">LocalStorage 저장 • 오프라인 동작 • 순수 HTML/CSS/JS • Bootstrap 반응형</p>
  </div>

  <!-- Chatbot FAB (우측 하단 둥둥 떠다니는 버튼) -->
  <button id="chatbotFab" class="cb-fab" aria-haspopup="dialog" aria-controls="chatbotSheet" aria-label="일정 요약 챗봇 열기">
    <span class="cb-fab__dot" aria-hidden="true"></span>
    <span class="cb-fab__glow" aria-hidden="true"></span>
  </button>

  <!-- Chatbot Sheet (애플 느낌 유리 질감 패널) -->
  <div id="chatbotSheet" class="cb-sheet" role="dialog" aria-modal="true" aria-labelledby="cbTitle" hidden>
    <div class="cb-panel" role="document">
      <header class="cb-header">
        <div class="cb-header__titlewrap">
          <span class="cb-notch" aria-hidden="true"></span>
          <h2 id="cbTitle">일정 요약 챗봇</h2>
          <p class="cb-subtle">캘린더·할 일 요약 챗봇 (UI 전용)</p>
        </div>
        <div class="cb-header__actions">
          <button class="cb-iconbtn" id="cbCloseBtn" aria-label="닫기">✕</button>
        </div>
      </header>

      <main class="cb-body" id="cbBody">
        <!-- 샘플 메시지 (디자인 프리뷰용, 실제 데이터 아님) -->
        <div class="cb-msg cb-msg--ai">
          <div class="cb-msg__bubble">
            안녕! 오늘 일정 요약해줄게.
          </div>
          <span class="cb-time">19:58</span>
        </div>

        <div class="cb-msg cb-msg--user">
          <div class="cb-msg__bubble">
            오늘 일정 한 줄로 요약해줘
          </div>
          <span class="cb-time">19:59</span>
        </div>
      </main>

      <footer class="cb-footer">
        <div class="cb-inputwrap">
          <input id="cbInput" type="text" class="cb-input" placeholder="메시지 입력… (실제 동작함)" />
          <button id="cbSendBtn" class="cb-send" type="button" aria-label="전송">➤</button>
        </div>
        <p class="cb-hint">너무 많이 쓰면 토큰때문에 돈 많이 나감</p>
      </footer>
    </div>
  </div>

  <!-- 팝업 전용 스크립트 -->
  <script th:src="@{/js/chatbot-popup.js}"></script>

  <!-- App script -->
  <script th:src="@{/js/script.js}"></script>

  <!-- Bootstrap Bundle WebJar -->
  <script th:src="@{/webjars/bootstrap/5.3.3/js/bootstrap.bundle.min.js}"></script>
  <!-- SweetAlert2 WebJar -->
  <script th:src="@{/webjars/sweetalert2/11.14.1/dist/sweetalert2.min.js}"></script>
</body>
</html>

